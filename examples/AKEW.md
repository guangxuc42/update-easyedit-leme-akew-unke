# AKEW: Assessing Knowledge Editing in the Wild

This README is about reproducing the paper [AKEW: Assessing Knowledge Editing in the Wild](https://arxiv.org/abs/2402.18909).

## Table of Contents

- [Dataset Description](#Dataset-Description)
- [Running Examples of Using AKEW](#Running-Examples-of-Using-AKEW)
---

## Dataset Description

**AKEW** is a practical benchmark for evaluating knowledge editing methods in realistic scenarios. Unlike prior work focused on structured facts, AKEW covers three settings: structured facts, unstructured texts, and extracted triplets. It introduces three datasets with both counterfactual and real-world knowledge updates, better reflecting the complexity of real-world edits. AKEW highlights the performance gap of existing methods and encourages more practical approaches to knowledge editing in large language models.
**Note:** You can download their dataset from [Github](https://github.com/bobxwu/AKEW).

The data format of **AKEW** are as follows:

There are three datasets: **CounterFact**, **MQuAKE-CF**, and **WikiUpdate** in JSON.  
A sample in them looks like

    {
        "case_id": 8,
        "pararel_idx": 14780,
        "requested_rewrite": {
            "prompt": "What is the twin city of {}? It is",
            "relation_id": "P190",
            "target_new": {
                "str": "Sheffield",
                "id": "Q42448"
            },
            "target_true": {
                "str": "Sydney",
                "id": "Q3130"
            },
            "subject": "Wellington",
            "prompt_full": "What is the twin city of Wellington? It is",
            "fact_new": "What is the twin city of Wellington? It is Sheffield.",
            "question": "What is the twin city of Wellington? It is what?",
            "answer_new": "Sheffield",
            "answer_new_aliases": [],
            "answer_true": "Sydney",
            "answer_true_aliases": [],
            "fact_new_uns": "Sheffield, a city in South Yorkshire, England, is known for its rich industrial heritage and vibrant cultural scene. With a history dating back to the 12th century, Sheffield has grown into a modern and diverse city. It is also known as the twin city of Wellington, ...",
            "verify_unsfact_GPT": true,
            "unsfact_triplets_GPT": [
                {
                    "subject": "Sheffield",
                    "prompt": "{} is located in",
                    "target": "South Yorkshire, England"
                },
                ...
                {
                    "subject": "Sheffield",
                    "prompt": "{} is known as the twin city of",
                    "target": "Wellington"
                },
                ...
            ],
            "time_true": {
                "start_time": ...,
                "end_time": ...
            },
            "time_new": {
                "start_time": ...,
                "end_time": ...
            }
        },
    }

The explanations are

- `requested_rewrite`: The requested rewrite information for editing, with the following fields:
    - `subject`: The subject.
    - `prompt`: The prompt template.
    - `prompt_full`: The full prompt with `subject`.
    - `relation_id`: The relation id defined in Wikidata.
    - `target_new`: The new entity (object).
        - `str`: Entity name.
        - `id`: The entity ID in Wikidata.
    - `target_true`: The old entity (object).
        - `str`: Entity name.
        - `id`: The entity ID in Wikidata.
    - `answer_new`: The new answer to be edited into a language model.
    - `answer_new_alias`: The aliases of `answer_new`.
    - `answer_true`: The old answer.
    - `answer_true_alias`: The aliases of `answer_true`.
    - `question`: The question used for query.
    - `fact_new`: The new fact with `target_new`.
    - `fact_new_uns`: The unstructured fact, generated by ChatGPT in **CounterFact** and **MQuAKE-CF** or retrieved from **Wikipedia** in WikiUpdate.
    - `verify_unsfact_GPT`: The verification result. We use ChatGPT to verify if the `fact_new_uns` aligns with `fact_new`.
    - `unsfact_triplets_GPT`: Extracted triplets from `fact_new_uns` by ChatGPT.
        - `subject`: The subject of a triplet.
        - `prompt`: The relation of a triplet.
        - `target`: The object of a triplet.
    - `time_true`:
        - `start_time`: The start time of the fact with `target_true` as the object.
        - `end_time`: The end time.
    - `time_new`:
        - `start_time`: The start time of the fact with `target_new` as the object.
        - `end_time`: The end time. This value is `null` in most cases.


`time_true` and `time_new` only exist in **WikiUpdate**.  
See also the explanations of [**MQuAKE-CF**](https://github.com/princeton-nlp/MQuAKE) about their samples for multi-hop editing.


## Running Examples of AKEW

If you want to know how to easily use EasyEdit with the **AKEW** dataset. You can follow the steps below:

1️⃣ Create a new directory `EasyEdit/data/AKEW` and download the files such as `CounterFact.json` from [GitHub](https://github.com/bobxwu/AKEW/tree/master/datasets) into this folder.

2️⃣ Run the main experiment with:
```bash
bash run_akew.sh
```
The `run_akew.sh` script includes a sample command just like:
```
python run_akew.py \
 --editing_method=FT \
 --hparams_dir=../hparams/FT/qwen2.5-7b.yaml \
 --data_dir=../data/AKEW \
 --edit_type=extract \# [struct, unstruct, extract]
 --ds_size=2 \
 --data_type=WikiUpdate \# [CounterFact, MQuAKE-CF, WikiUpdate]
```
